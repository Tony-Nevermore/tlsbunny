version '1.0-SNAPSHOT'

apply plugin: 'java'
apply plugin: 'idea'
apply plugin: 'application'

sourceCompatibility = 1.9

repositories {
    mavenCentral()
}

dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.+'
}

task buildOpensslDocker(type: Exec) {
    commandLine 'docker',
            'build',
            '--file', 'configs/openssl/tls13/server/Dockerfile',
            '--tag', 'openssl/server/tls13',
            '.'
}

task buildPicotlsDocker(type: Exec) {
    commandLine 'docker',
            'build',
            '--file', 'configs/picotls/tls13/server/Dockerfile',
            '--tag', 'picotls/server/tls13',
            '.'
}

task buildGnutlsDocker(type: Exec) {
    commandLine 'docker',
            'build',
            '--file', 'configs/gnutls/tls13/server/Dockerfile',
            '--tag', 'gnutls/server/tls13',
            '.'
}

// tasks for running tests for OpenSSL

task opensslHttpsClient(type: JavaExec) {
    classpath sourceSets.main.runtimeClasspath
    main = "com.gypsyengineer.tlsbunny.tls13.test.openssl.client.HttpsClient"
}

task opensslFuzzyClient(type: JavaExec) {
    classpath sourceSets.main.runtimeClasspath
    main = "com.gypsyengineer.tlsbunny.tls13.test.openssl.client.FuzzyClient"
}

task opensslClientAuth(type: JavaExec) {
    classpath sourceSets.main.runtimeClasspath
    main = "com.gypsyengineer.tlsbunny.tls13.test.openssl.client.ClientAuth"
}

task opensslFuzzyClientAuth(type: JavaExec) {
    classpath sourceSets.main.runtimeClasspath
    main = "com.gypsyengineer.tlsbunny.tls13.test.openssl.client.FuzzyClientAuth"
}

// tasks for running tests for picotls

task picotlsClient(type: JavaExec) {
    classpath sourceSets.main.runtimeClasspath
    applicationDefaultJvmArgs = ["-Dtlsbunny.port=20101"]
    main = "com.gypsyengineer.tlsbunny.tls13.test.picotls.client.PicotlsClient"
}
